# [202. 快乐数](https://leetcode.cn/problems/happy-number/description/)

> **日期**：2025-12-21
> **所用时间**：12min
> **知识点**：哈希表、数学

## 1. 哈希表

本题考查：哈希表思想、循环检测、数位分解

### 题目简述

给定一个正整数 $n$，不断对该数做如下操作：将其每一位数字的平方和作为新的 $n$，如此循环。如果最终可以变成 $1$，说明 $n$ 是快乐数，否则不是。**问如何判断一个数是不是快乐数？**

### 解题思路：哈希表 + 循环检测

- 题目核心是：如果过程中出现了重复的状态（数值），说明已经进入循环，之后永远不可能变为 $1$，应该立即返回 False。
- 如果循环的过程中出现了 $1$，则说明是快乐数，返回 True。
- 哈希表/集合用于记录所有出现过的数值，遇到重复即判死循环。

#### 操作步骤

1. 用一个集合 $mp$ 记录过程中出现的每个数。
2. 每次将当前数 $n$ 各位数字的平方相加，得到新的 $n$。
3. 如果 $n==1$，返回 True（是快乐数）。
4. 如果 $n$ 再次出现于哈希表，返回 False（进入死循环，不是快乐数）。
5. 否则将 $n$ 加入哈希表，继续循环。

#### 小技巧

- 数位分解与累加可以用 `n % 10` 和 `n //= 10` 循环完成。
- 初始将原始 $n$ 放入集合是为了和后续循环一致。

### 复杂度分析

- 时间复杂度：$O(n)$  
  由于每一轮 $n$ 都会变小，且数位平方和的数目有限，最坏不过反复最多几十步便检测出循环，不会超时。
- 空间复杂度：$O(n)$  
  哈希集合最多保存每个出现过的数，每次至多几十个。

### 示例流程

以 $n=19$ 为例：

- $19$ → $1^2+9^2=82$
- $82$ → $8^2+2^2=68$
- $68$ → $6^2+8^2=100$
- $100$ → $1^2+0^2+0^2=1$
- 到达 $1$，快乐数，返回 True。

如果以 $n=2$ 为例：

- $2→4→16→37→58→89→145→42→20→4$ （出现 $4$ 第二次，形成环，非快乐数）

**Python3**

```python
class Solution:
    def isHappy(self, n: int) -> bool:
        mp = {n}

        while n != 1:
            t = 0
            while n:
                t += (n % 10)**2
                n //= 10
            n = t
            if n in mp:
                return False
            mp.add(n)
        return True
```
