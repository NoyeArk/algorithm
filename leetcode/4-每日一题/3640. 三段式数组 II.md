# [3640. 三段式数组 II](https://leetcode.cn/problems/three-part-array-ii/description/)

> **日期**：2026-02-04  
> **所用时间**：8min  
> **知识点**：动态规划

## 1. 题目描述

给你一个长度为 n 的整数数组 `nums`。

若数组能被划分为三段，且满足以下性质，则称为**三段式数组（trionic）**：

- **第一段**：严格递增（从左到右）
- **第二段**：严格递减
- **第三段**：严格递增

其中相邻元素不能相等（严格单调）。三段必须非空，且顺序为「增 → 减 → 增」。

请返回所有可能的三段式子数组的**最大和**。如果不存在三段式子数组，返回一个足够小的值（如 `-inf`）。

**示例：**

- `nums = [1, 3, 2, 4]`：存在三段式子数组 `[1, 3, 2, 4]`，和为 10
- `nums = [1, 2, 3]`：不存在三段式子数组，返回 `-inf`

**约束：** 3 ≤ nums.length ≤ 10⁵

## 2. 解题算法

本题是**动态规划**问题，需要找到所有可能的三段式子数组并求最大和。

**状态定义：**
- `f1`：当前处于第一段（递增段）的最大和
- `f2`：当前处于第二段（递减段）的最大和  
- `f3`：当前处于第三段（递增段）的最大和

**状态转移：**
遍历相邻元素对 `(x, y)`：

1. **第一段（f1）**：`x < y` 时，可以继续第一段或开始第一段
   - `f1 = max(f1, 0) + y`（取之前最大值或从当前位置开始）

2. **第二段（f2）**：`x > y` 时，必须从第一段转移而来
   - `f2 = max(f2, f1) + y`（从第一段的最大值转移）

3. **第三段（f3）**：`x < y` 时，必须从第二段转移而来
   - `f3 = max(f3, f2) + y`（从第二段的最大值转移）

**初始化：** 所有状态初始化为 `-inf`，表示尚未达到该阶段。

**复杂度分析：**

- 时间复杂度：O(n)，单次遍历数组
- 空间复杂度：O(1)，仅用三个状态变量

**Python3**

```python
class Solution:
    def maxSumTrionic(self, nums: List[int]) -> int:
        ans = f1 = f2 = f3 = -inf
        for x, y in pairwise(nums):
            f3 = max(f3, f2) + y if x < y else -inf
            f2 = max(f2, f1) + y if x > y else -inf
            f1 = max(f1, x) + y if x < y else -inf
            ans = max(ans, f3)
        return ans
```