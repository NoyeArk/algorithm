# [840. 矩阵中的幻方](https://leetcode.cn/problems/magic-squares-in-grid/description/)

> **日期**：2025-12-30  
> **所用时间**：26min  
> **知识点**: 模拟

## 1. 模拟

1. **遍历所有可能的3x3子矩阵**  
   - 遍历所有可以作为左上角的坐标 `(i, j)`。

2. **子矩阵检查函数**  
   对每个 `3x3` 子矩阵，做以下判断：
   - 行和是否均相等
   - 列和是否均相等
   - 主对角线、副对角线和是否等于行和
   - 3x3格子里的数是不是1到9且各出现一次

3. **计数**  
   - 统计所有满足条件的子矩阵数量。

复杂度分析：

- 时间复杂度: $O(mn)$
- 空间复杂度: $O(1)$

**Python3**

```python
class Solution:
    def numMagicSquaresInside(self, grid: List[List[int]]) -> int:
        ans = 0
        n, m = len(grid), len(grid[0])

        def check(i0, i1, j0, j1):
            s = sum(grid[i0][j0:j1+1])

            # 判断每一行的和是否相等
            if any(sum(grid[i][j0:j1+1]) != s for i in range(i0, i1 + 1)):
                return False
            
            # 判断每一列的和是否相等
            if any(sum(row[j] for row in grid[i0:i1+1]) != s for j in range(j0, j1 + 1)):
                return False
            
            # 判断主对角线的和是否相等
            if sum(grid[i0+t][j0+t] for t in range(3)) != s:
                return False
            
            # 判断副对角线的和是否相等
            if sum(grid[i0+t][j1-t] for t in range(3)) != s:
                return False

            # 判断是否包含数字1-9
            strs = list(str(grid[i][j]) for i in range(i0, i1+1) for j in range(j0, j1+1))
            strs.sort()
            if ''.join(strs) != '123456789':
                return False
            return True

        for i in range(n - 2):
            for j in range(m - 2):
                ans += int(check(i, i + 2, j, j + 2))
        return ans
```